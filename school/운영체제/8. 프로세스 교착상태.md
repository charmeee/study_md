#deadlock 
## 발생 조건
1. 상호 배제(mutual exclusion= mutex)
	동시에 한자원을 한 프로세스만 사용가능하다.
	이게 아니라면 교착상태가 애시당초 발생하지 않음(한 자원을 한번에 여러프로세스가 접근 가능하니까) 
2. 점유 상태로 대기(hold and wait)
	하나이상의 자원을 가진 프로세스가 다른 프로세스가 가지고 있는 다른 자원을 획득하기 위해 기다린다.
3. 선점 불가(no preemption)
	프로세스가 가진 자원은 사용이 끝난 후에 자발적으로만 방출될 수 있다.(== 뺏을 수 없다.)
4. 순환성 대기(circulal wait)
	프로세스 집합이 존재할 때 순환형으로 자원을 기다리고 있는상황
	자원 할당 그래프를 그려보면 사이클이 발생하는지 알 수 있다.
	그래프에 사이클이 존재하지 않는다 => 교착상태 ㄴㄴ
	“”에 사이클이 존재한다
		자원타입마다 오직 하나의 인스턴스가 있다 -> 교착상태 발생
		여러개 있으면 교착상태 발생 가능성 있음
	![[Pasted image 20240418211706.png]]
이 4가지 조건이 동시에 만족할 때 발생한다. BUT 4가지조건이 동시에 만족한다고 반드시 교착상태가 발생하는 것은 아니다.

## 예시
자원 A,B를 두개의 스레드S1,S2가 동시에 사용하려고 함
이때 자원이 두개니 뮤텍스또한 두개고 A가 있는 뮤택스를 LockA, B가 있는 뮤텍스를 LockB라고 하자.
1. S1이 LockA를 확인한다. 내려가 있으니 올린다.(=1이되면 누군가 점유하고 있다는 뜻이고 다른프로세스는 이자원을 획득하기 위해선 기다린다.). 후 자원을 S1이 점유. S1 : wait(A)
2. S2가 LockB를 확인한다. 내려가 있으니 올리고 자원을 점유 S2 : wait(B)
-- 지금까지 S1은 A를 소유 , S2는 B를 소유하고 있다. —
3. S1은 LockB를 확인한다. 안내려가 있으니 대기
4. S2는 LockA를 확인한다. 안내려가 있으니 대기
-- 교착상태 —

## 교착상태 핸들링
### 예방(prevention)
위의 4가지 필수조건 중 하나라도 발생하지 않게한다
- 상호 배제 : 비공유자원을 미리확보,상호배제 조건을 인정하지 않는 경우는 거의 불가능하기에
- 점유 상태로 대기 : 자원 요청시 어떠한 자원을 보유하지 않음을 보장(But 낮은 자원활용율, 기아 초래)
- 선점 불가 : 자원보유중인 프로세스가 다른자원을 즉시 할당받지 않을시 소유중인 자원을 모두 방출
	선점 당한 프로세스는 기존 자원과 새로요청한 자원을 확보 할 수 있는 경우에만 실행
- 순환 대기 : 모든 자원유형을 전체 순서를 정하여 자원요청
### 회피(avoidance)
각 요청을 운영체제가 직접 분석함으로써 데드락이 발생할 가능성을 확인(동적임)
사용가능한 추가적인 사전 정보를 시스템이 가저야 한다
- 상태 판단
	safe state인지를 판단하여 교착상태에 빠지지 않게 한다
	safe state : 모든프로세스에 순서가 존재함, 교착상태 발생불가
	unsafe state : 교착상태 발생 가능성있음(반드시 발생 ㄴㄴ)
	![[Pasted image 20240418214254.png|300]]
#### 자원할당 그래프
- 자원이 하나의 인스턴스만 있는 경우

![[Pasted image 20240423222740.png|300]]
이렇게 사이클이 생기면 unsafe state라는 것
#### banker 알고리즘
- 자원이 여러개의 인스턴스가 있는 경우
- 각 프로세스는 최대 필요한 자원수를 선언
- 모든 리소스 가져올 시 유한 시간 내 반환
- need = max - allocation
![[Pasted image 20240423223102.png|500]]
1. p1 할당 반환 , available : 5 3 2
2. p3 할당 반환 , available : 7 4 3
3. p4 할당 반환 , available : 7 4 5
4. p0 할당 반환 , available : 7 5 5
5. p2 할당 반환 , available : 10 5 7

### 탐지(detection)
데드락이 반드시 발생할것을 가정하고 어느부분이 데드락이 발생햇는지 탐색하는 방식
### 복구(recovery)
프로세스를 강제로 종료시거나 자원을 강제로 회수한다.