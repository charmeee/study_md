### 폴링
주 프로그램안에서 cpu명령어를 이용하여 외부 장치의 상태를 반복적으로 확인
CPU프로그램에서 장치연결의 포트핀의 디지털 전압레벨에 대한 논리값을 반복적으로 일고 원하는 상태가 감지되면 알고리즘 수행단계를 변경
#### 레벨 감지
전압레벨 값 0,1 을 감지하는거
#### 에지 감지
0->1 될때 1->0될때 상승하강 변경을 감지함.


##### P0에 스위치 연결 스위치 동작을 폴링으로
레벨
```
# include<avr/io.h>
int main(){
	DDRB &= ~(1<<PB0);//입력
	DDRD |= (1<<PB0); //출력
	while(1){
		if(PINB&1<<PB0){
			//negative
			PORTD &= ~(1<<PD0) //off
		}else{
			//positive
			PORTD |= 1<<PD0 //on
		}
	}
	return 0;
}
```
엣지
```
# include<avr/io.h>
int main(){
	DDRB &= ~(1<<PB0);//입력
	DDRD |= (1<<PB0); //출력
	int start = PINB & 1<<PB0 ?1:0;
	while(1){
	//상승에지
		for(prev = now = start;!(now==1&&prev==0);now=start){
			prev = now;
			PORTD ^= 1<PD0; // 출력 반전.
		}
	}
	
	return 0;
}
```

### 인터럽트 
외부 또는 내부에서 발생되는 사건에 대하여 CPU 하드웨어의 도움을 받아 자동으로 감지되고, 인터럽트 서비스 루틴이 자동으로 실행 되는 메커니즘
발생 절차
 ① 1단계 SREG의 I-비트를 0으로 클리어, 현재 실행 중인 명령어를 실행 완료 
 ② 2단계 스택 포인터(SP)를 감소 
 ③ 3단계 PC를 SP가 가리키는 스택에 보관 
 ④ 4단계 PC에 인터럽트 벡터 주소를 넣고, 인터럽트 발생 플래그를 0으로 클리어 
 ⑤ 5단계 변경된 PC에서부터 인터럽트 서비스 루틴이 수행

포토 인터럽터 = 포토다이오드 + 포토트렌지스터
적외선이 트렌지스터 베이스로 투과 , 다이오드랑 트렌지스터 간격에 자외선 차단시켜 센서동작.
##### 상승엣지 TO 하강
```
EMISK |= 1 << INT0; // INT0 인터럽트 활성화 
EICRA = 3 << ISC00; // 상승에지 인터럽트 설정 끝이 1이면 상승
PORTD |= 1 << PD0; // PD0(INT0) 핀 내부에 풀업저항 설정 
sei(); // 전역 인터럽트 활성화

정답
EICRA = 2 << ISC00; // 하강에지 인터럽트 설정 끝이 0 이면하강
```


##### P0에 스위치 연결 스위치 동작을 인터럽트로 인식하는 방법을 코드로.
 ```
#include <avr/io.h>
#include <avr/interrupt.h>

ISR(INTO_vect){
	PORTD ^= (1<<PD0)// LED 상태 변경
	req=0;
}

int main(voiod){
	DDRD  |= (1<<PD0) // 출력
	EIMSK |= (1<< INTO); // INT0 인터럽트 활성화 
	EICRA |= (1<<ISC00);//상승

	PORTB |= 1 << PB0; // PDB(INT0) 핀 내부에 풀업저항 설정 
	sei();//전역인터럽트 활성화
	while(1){
		if(!req){//req==0
			req=1;
		}
	}
	return 0; 
}
 ```
트리거링 입력신호 == 인터럽트를 발생시키기 위해 사용되는 신호

##### 1. PORT A0를 이용하여 트리거링 입력 신호를 얻고자 한다. level, positive edge와 negative edge 트리거를 감지하는 프로그램을 각각 작성하시오.

```
#include <avr/io.h>
#include <avr/interrupt.h>
int main(){

	DDRA &= ~(1<<PA0);
	EIMSK |= (1<<INTO);
	
	/*여기서 차이가남*/
	EICRA &= ~((1<<ISC01 | 1<<ISC00 ));	//LEVEL
	EICRA |= ((1<<ISC01 | 1<<ISC00 ));	//Positive
	EICRA |= (1<<ISC01);	//Positive

	sei();
	while(1){
	}
	return 0;

}

```
### 7세그먼트제어

5진 카운터 동작하는 프로그램

```c
#include <avr/io.h>

unsigned char digit[] = {0x77, 0x41, 0x3B, 0x58, 0x4D, 0x5E, 0x7C, 0x43, 0x7F, 0x4F}:
void display 7sealed(unsigned char led[l. unsigned int number){
	PORTC = led[number];
}
int main(void) { 
	DDRC = 0xFF; uint8_t count = 0; while (1) { 
		display_7segled(digit, count); 
		_delay_ms(1000); 
		count++; 
		if (count == 5) { count = 0; }
	} 
	return 0; 
}

```



### 타이머 카운터 T/C

pwm duty cycle rate 듀티비 = 펄스폭시간 / 주기 * 100
